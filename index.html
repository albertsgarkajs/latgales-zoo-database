<!DOCTYPE html>
<html lang="lv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Latgales Zoodārza Dzīvnieku Datubāze</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Verdana, sans-serif;
      background: #e8f5e9;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    #loadingMessage {
      font-size: 18px;
      color: #2E8B57;
      text-align: center;
    }
    #errorMessage {
      color: red;
      font-size: 16px;
      text-align: center;
      max-width: 80%;
      margin-top: 20px;
    }
    #manualLinks {
      margin-top: 20px;
      font-size: 14px;
      text-align: center;
    }
    #manualLinks a {
      color: #2E8B57;
      text-decoration: none;
      margin: 0 10px;
    }
    #manualLinks a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div id="loadingMessage">Ielādējam...</div>
  <div id="errorMessage" style="display: none;"></div>
  <div id="manualLinks" style="display: none;">
    <p>Nevarēja automātiski novirzīt. Izvēlieties versiju:</p>
    <a href="/index-pc.html">PC versija</a> | <a href="/index-mobile.html">Mobilā versija</a>
  </div>
  <script>
    function isMobileDevice() {
      const isMobileUA = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      const isSmallScreen = window.innerWidth <= 768;
      console.log('[index.html] User Agent: ' + navigator.userAgent);
      console.log('[index.html] Window Width: ' + window.innerWidth);
      console.log('[index.html] isMobileUA: ' + isMobileUA + ', isSmallScreen: ' + isSmallScreen);
      return isMobileUA && isSmallScreen;
    }

    function showError(message) {
      console.error('[index.html] ' + message);
      document.getElementById('loadingMessage').style.display = 'none';
      document.getElementById('errorMessage').textContent = message;
      document.getElementById('errorMessage').style.display = 'block';
      document.getElementById('manualLinks').style.display = 'block';
    }

    function performRedirect() {
      const currentPath = window.location.pathname;
      console.log('[index.html] Current Path: ' + currentPath);
      if (currentPath === '/index-pc.html' || currentPath === '/index-mobile.html') {
        console.log('[index.html] Already on target page, skipping redirect');
        document.getElementById('loadingMessage').style.display = 'none';
        document.getElementById('errorMessage').style.display = 'none';
        document.getElementById('manualLinks').style.display = 'none';
        return;
      }

      console.log('[index.html] Checking device type');
      const lastRedirect = localStorage.getItem('lastRedirect');
      const now = Date.now();
      if (lastRedirect && now - parseInt(lastRedirect) < 2000) {
        showError('Kļūda: Novirzīšana bloķēta, lai novērstu cilpu. Lūdzu, izvēlieties versiju zemāk.');
        return;
      }

      const targetUrl = isMobileDevice() ? '/index-mobile.html' : '/index-pc.html';
      console.log('[index.html] Attempting to redirect to: ' + targetUrl);
      fetch(targetUrl, { method: 'HEAD', cache: 'no-store' })
        .then(response => {
          if (response.ok) {
            console.log('[index.html] Target URL exists, performing redirect');
            localStorage.setItem('lastRedirect', now);
            window.location.replace(targetUrl);
          } else {
            showError('Kļūda: Nevar atrast ' + targetUrl + '. Lūdzu, izvēlieties versiju zemāk.');
          }
        })
        .catch(error => {
          showError('Kļūda pārbaudot ' + targetUrl + ': ' + error.message);
        });

      setTimeout(() => {
        if (window.location.pathname === '/index.html' || window.location.pathname === '/') {
          showError('Novirzīšana neizdevās. Lūdzu, izvēlieties versiju zemāk.');
        }
      }, 5000);
    }

    window.onload = () => {
      console.log('[index.html] Window loaded, initiating redirect');
      performRedirect();
    };
  </script>
</body>
</html>
